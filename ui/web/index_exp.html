<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Work Estimation</title>
    <script language="javascript" type="text/javascript" src="jquery.jqplot/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="jquery.jqplot/jquery.jqplot.min.js"></script>
    <script type="text/javascript" src="jquery.jqplot/plugins/jqplot.logAxisRenderer.js"></script>
    <link rel="stylesheet" type="text/css" href="jquery.jqplot/jquery.jqplot.css" />
    <style type="text/css">

        #area{
            display:none;
        }

    </style>
    <script>

        function openMappingDiv(){
            document.getElementById("area").style.display = "block";
        };
        function hideMappingDiv(){
            document.getElementById("area").style.display = "none";
        }

    </script>
</head>
<body>
    <h1>Work Estimation</h1>
    <fieldset>

        <legend>Open file</legend>

        <input type="file" id="excelFile"/>

    </fieldset>

    <fieldset>

        <legend>Reading of tasks</legend>

        <label><input type="text" id="sheetName"> Sheet name</label><br>
        <label><input type="text" id="firstRow"> First row</label><br>
        <label><input type="text" id="lastRow"> Last row</label><br>
        <label><input type="text" id="rowSkip"> Rows to skip</label><br>
        <label><input type="button" value="+" onmousedown="openMappingDiv()"></label>
        <label><input type="button" value="-" onmousedown="hideMappingDiv()"></label>

    <div id="area">
        <table border="0" widtd="100%">
            <tr>
                <td>uid
                    <select  name="uid" id="uid">
                        <option value=""></option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="H">H</option>
                        <option value="I">I</option>
                        <option value="J">J</option>
                        <option value="K">K</option>
                        <option value="L">L</option>            
                    </select>
                </td>
                <td>min_estimate
                    <select name="min_estimate" id="minEst">
                        <option value=""></option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="H">H</option>
                        <option value="I">I</option>
                        <option value="J">J</option>
                        <option value="K">K</option>
                        <option value="L">L</option>            
                    </select>
                </td>
            </tr>
            <tr>                        
                <td>name
                    <select name="name" id="nam">
                        <option value=""></option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="H">H</option>
                        <option value="I">I</option>
                        <option value="J">J</option>
                        <option value="K">K</option>
                        <option value="L">L</option>            
                    </select>
                </td>
                <td>normal_estimate
                    <select name="normal_estimate" id="norEst">
                        <option value=""></option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="H">H</option>
                        <option value="I">I</option>
                        <option value="J">J</option>
                        <option value="K">K</option>
                        <option value="L">L</option>            
                    </select>
                </td>
            </tr>
            <tr>
                <td>blockers
                    <select name="blockers" id="blockers">
                        <option value=""></option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="H">H</option>
                        <option value="I">I</option>
                        <option value="J">J</option>
                        <option value="K">K</option>
                        <option value="L">L</option>            
                    </select>
                </td>
                <td>max_estimate
                    <select name="max_estimate" id="maxEst">
                        <option value=""></option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="H">H</option>
                        <option value="I">I</option>
                        <option value="J">J</option>
                        <option value="K">K</option>
                        <option value="L">L</option>            
                    </select>
                </td>
                </td>
            </tr>
        </table>
    </div> 

    </fieldset>

    <fieldset>

        <legend>Load</legend>

        <div id="place">

            <input type="submit" name="but" id="loadTasksButton" value="Load">

        </div>

    </fieldset>
    <fieldset>

        <legend>Print</legend>

        <div id="schedule">

            <table border="0" widtd="100%">
                <tr>
                    <td>Tasks
                        <select name="tasks" id="tasks">
                            <option value=""></option>
                            <option value="0">Task 1</option>
                            <option value="1">Task 2</option>
                            <option value="2">Task 3</option>
                            <option value="3">Task 4</option>
                            <option value="4">Task 5</option>
                            <option value="5">Task 6</option>
                            <option value="6">Task 7</option>
                            <option value="7">Task 8</option>
                            <option value="8">Task 9</option>
                            <option value="9">Task 10</option>
                            <option value="10">Task 11</option>
                            <option value="11">Task 12</option>            
                        </select>                       
                    </td>
                    <td>
                        <input type="button" value="Print" id="printGraphicButton">
                    </td>
                </tr>
                <tr>
                    <td>
                        <div id="chartdiv" style="height:500px;width:300px; "></div>
                    </td>
                </tr>
                </table>
    </fieldset>

    <script>  

        var applicationContext = {};
                                   
        function loadTasks() {
            var excelFile = $('#excelFile').get(0).files.item(0);;
            $.ajax({
                type: 'PUT',
                url: 'http://localhost:5000/api/excelWorkbook',
                data: excelFile,
                contentType: 'application/vnd.ms-excel',
                processData: false,
                success: function (data) {
                    var requestBody = {
                      sheet: $("#sheetName").val(),
                      first_row: +$("#firstRow").val(),
                      last_row: +$("#lastRow").val(),
                      rows_to_skip: $("#rowSkip").val(),
                      columns_mapping: {
                        uid: $("#uid").val(),
                        name: $("#nam").val(),
                        blockers: $("#blockers").val(),
                        min_estimate: $("#minEst").val(),
                        normal_estimate: $("#norEst").val(),
                        max_estimate: $("#maxEst").val()
                      }
                    } 
                    alert("Response received: " + JSON.stringify(data));
                    requestBody.file = data.tempFileName;
                    $.ajax({
                        type: 'POST',
                        url: 'http://localhost:5000/api/excelWorkbook/tasks',
                        contentType: 'application/json',
                        data: JSON.stringify(requestBody),
                        success: function (data) {
                            alert("Response received: " + JSON.stringify(data));                         
                            applicationContext.tasks = data.tasks;
                        }    
                    });    
                }
             });                           
        };

        function printTaskGraphic() {
            var taskToPrintIndex = $("#tasks").val(); 
            var taskToPrint = applicationContext.tasks[taskToPrintIndex];
            var inquiryPoints = {
              "numberOfPoints": 50, 
               "tasks": [taskToPrint]
            }; 
            $.ajax(

            {
                type: 'POST',
                url: 'http://localhost:5000/api/tasks/normalDistribution',
                contentType: 'application/json',
                data: JSON.stringify(inquiryPoints),
                success: function drawTaskGraphic(data) {
                    //alert("Response received: " + JSON.stringify(data));                    
                    var tasksPlot = {};                    
                    var tasksObj = {};
                    var line = [];
                    tasksPlot.taskNormalDistributions = data.taskNormalDistributions;
                    tasksObj = tasksPlot.taskNormalDistributions[0];

                    for(var i = 0, iLen = tasksObj['x'].length; i < iLen; i++){
                        line.push([tasksObj['x'][i], tasksObj['y'][i]]); 
                    }

                    var plot = $.jqplot ('chartdiv', [line], {
                        title: tasksObj["taskUid"],
                        textColor:"#6A5ACD",            
                        grid:{borderWidth:4.0,
                        gridLineColor: "#CCCCFF"},        
                        axes:{
                        yaxis:{min:0, 
                        max:1,
                        tickInterval:0.1},   
                        xaxis:{min:0, 
                        max:tasksObj['max_x']+1,
                        numberTicks: tasksObj['max_x']+2,
                        tickInterval:1}
                        }, 
                        series:[{color:'#293133'}],   
                        axesDefaults:{min:0},            
                        seriesDefaults:{showMarker:false,  
                        lineWidth: 3.5}   
                    });                   
                }       
            });
        };

        $("#loadTasksButton").click(loadTasks);         
        $("#printGraphicButton").click(printTaskGraphic);        

    </script>
</body>
</html>